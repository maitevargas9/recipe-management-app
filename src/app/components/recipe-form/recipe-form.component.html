<div class="recipe-form">
  <h2>{{ editMode ? 'Edit recipe' : 'New recipe' }}</h2>

  <form [formGroup]="form" (ngSubmit)="save()">
    <label>
      Name:
      <input formControlName="name" />
    </label>

    <label>
      Description:
      <textarea formControlName="description"></textarea>
    </label>

    <label>
      Portions:
      <input type="number" formControlName="basePortions" min="1" />
    </label>

    <fieldset>
      <legend>Category</legend>
      <div *ngFor="let cat of categories">
        <label>
          <input type="checkbox" [checked]="form.value.categories.includes(cat)"
            (change)="onCheckboxChange($event, 'categories', cat)" />
          {{ cat }}
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Diet Types</legend>
      <div *ngFor="let dt of dietTypes">
        <label>
          <input type="checkbox" [checked]="form.value.dietTypes.includes(dt)"
            (change)="onCheckboxChange($event, 'dietTypes', dt)" />
          {{ dt }}
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Meal Times</legend>
      <div *ngFor="let mt of mealTimes">
        <label>
          <input type="checkbox" [checked]="form.value.mealTimes.includes(mt)"
            (change)="onCheckboxChange($event, 'mealTimes', mt)" />
          {{ mt }}
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Ingredients</legend>
      <div formArrayName="ingredients">
        <div *ngFor="let ing of ingredients.controls; let i = index" [formGroupName]="i" class="ingredient-row">
          <input formControlName="name" placeholder="Ingredient" />
          <input type="number" formControlName="amount" min="0.1" step="0.1" />
          <select formControlName="unit">
            <option *ngFor="let u of units" [value]="u">{{ u }}</option>
          </select>
          <button type="button" (click)="removeIngredient(i)">ğŸ—‘ï¸</button>
        </div>
      </div>
      <button type="button" (click)="addIngredient()">â• Add ingredient</button>
    </fieldset>

    <button type="submit" [disabled]="form.invalid">
      {{ editMode ? 'Save' : 'Create' }}
    </button>
  </form>
</div>